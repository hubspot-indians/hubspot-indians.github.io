<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Watch Video ‚Äì Hubspot Indians</title>

  <!-- Video.js CSS -->
  <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />

  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:Arial,sans-serif;}
    body{background:#f9f9f9;color:#222;}
    header{display:flex;justify-content:space-between;align-items:center;padding:1rem;background:#cc0000;color:#fff;}
    header a{color:#fff;text-decoration:none;font-weight:bold;}
    .container{max-width:900px;margin:2rem auto;padding:1rem;}
    h1{margin-bottom:1rem;font-size:1.5rem;}
    .video-js{width:100%;height:500px;border-radius:8px;}
    .back{display:inline-block;margin-top:1rem;padding:.5rem 1rem;background:#cc0000;color:#fff;border-radius:4px;text-decoration:none;}
    #status { display: none; }
  </style>

  <!-- Video.js Ads Plugin -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/videojs-contrib-ads/6.9.0/videojs-contrib-ads.css" rel="stylesheet" />
  <link href="https://imasdk.googleapis.com/js/sdkloader/ima3.js" rel="stylesheet" />
</head>
<body>
  <header>
    <div>‚ñ∂ Hubspot Indians</div>
    <a href="index.html">üè† Home</a>
  </header>

  <div class="container">
    <h1 id="videoTitle">Loading...</h1>
    <div id="status"></div>
    <video id="videoPlayer" class="video-js vjs-big-play-centered" controls preload="auto" playsinline data-setup='{}'></video>
    <a href="javascript:history.back()" class="back">‚¨Ö Back to Videos</a>
  </div>

  <!-- Video.js JS -->
  <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>
  <!-- Video.js Ads -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/videojs-contrib-ads/6.9.0/videojs-contrib-ads.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/videojs-ima@1.8.0/dist/videojs.ima.min.js"></script>

  <script>
    // --- 1. CORS proxy list ---
    const proxyList = [
      "https://api.allorigins.win/get?url=",
      "https://corsproxy.io/?",
      "https://api.codetabs.com/v1/proxy?quest=",
      "https://thingproxy.freeboard.io/fetch/"
    ];

    // --- 2. Initialize Video.js ---
    const player = videojs("videoPlayer");

    // --- 3. Get GET parameters ---
    const params = new URLSearchParams(window.location.search);
    const videoUrl = params.get('url') || ''; // Video URL
    const title = params.get('title') || 'Untitled Video';
    // Use the fixed VAST URL directly
    const vastUrl = "https://heavenly-holiday.com/d/mtFpz.dnGKNWvAZ-GkUi/uePm/9EuUZIUAlSk/PwTaYd2yNjjxcI3KNPjvY/t/NIjJY/2_Nuzict2zNUy/Z/shaTWX1dpMdMDl0CxF";
    const statusEl = document.getElementById('status');

    document.getElementById('videoTitle').textContent = title;

    if (!videoUrl) {
      console.warn('Missing video URL');
    } else {
      playVideo(videoUrl);
    }

    // --- 4. Fetch HTML via proxies ---
    async function fetchWithProxies(targetUrl) {
      for (const proxy of proxyList) {
        try {
          const response = await fetch(proxy + encodeURIComponent(targetUrl));
          if (!response.ok) throw new Error("Proxy failed: " + proxy);
          const text = await response.text();
          if (text.includes("<html")) return text;
          const json = JSON.parse(text);
          if (json.contents) return json.contents;
        } catch(e) {
          console.warn("Proxy failed:", proxy);
        }
      }
      throw new Error("All proxies failed");
    }

    // --- 5. Play video ---
    async function playVideo(url) {
      const isVideoFile = /\.(mp4|webm|ogg|m3u8)(\?.*)?$/i.test(url);
      let videoSrc = url;

      if (!isVideoFile) {
        try {
          const html = await fetchWithProxies(url);

          // Extract .mp4 links
          const mp4Matches = [...html.matchAll(/https?:\/\/[^\s"']+\.mp4[^\s"']*/g)]
            .map(m => m[0])
            .filter(l => l.includes("cdn") || l.includes("xhamster"));

          if (mp4Matches.length === 0) {
            console.warn("No playable video found.");
            return;
          }

          videoSrc = mp4Matches[0];

          // Extract poster/thumbnail
          const posterMatch = html.match(/<meta property="og:image" content="([^"]+)"/);
          const posterUrl = posterMatch ? posterMatch[1] : "";
          if (posterUrl) player.poster(posterUrl);

        } catch (err) {
          console.error("Error loading video:", err.message);
          return;
        }
      }

      // --- 6. Setup VAST Ads if provided ---
      if (vastUrl) {
        player.ima({
          adTagUrl: vastUrl,
          debug: false,
          showCountdown: true
        });
      }

      // --- 7. Load and play video ---
      player.src({ src: videoSrc, type: "video/mp4" });
      player.load();
      player.play();
    }
  </script>
</body>
</html>
